---
title: Database System Concepts - notes
author: lambdaxing
date: 2022-12-05 18:00:00 +0800
categories: [Notes, Database]
tags: [Database]
---

>《Database System Concepts: Sixth Edition》笔记。

# 一. 引言：数据库系统的基本原理

&emsp;&emsp;数据库管理系统（Database-Management System，DBMS）由一个互相关联的数据的集合和一组用于访问这些数据的程序组成。计算机科学家开发了大量的用于有效管理数据的**概念**和**技术**，本书所关注的正是这些概念和技术。

## 1. 数据库系统的目标

&emsp;&emsp;数据库系统为了解决文件处理系统（在操作系统的文件处理系统中存储组织信息）中存在的问题，比如数据冗余、数据不一致、数据访问困难、数据孤立、完整性问题、原子性问题、并发与安全等，提出了许多**概念**和**算法**。

## 2. 数据视图

&emsp;&emsp;数据库系统是一些互相关联的数据以及一组使得用户可以访问和修改这些数据的程序的集合。数据库系统的一个主要目的是给用户提供数据的抽象视图，即数据库系统隐藏关于数据存储和维护的某些细节。

### 数据抽象

&emsp;&emsp;**数据抽象**的三个层次：
+ 物理层：描述数据的实际存储，物理层详细描述复杂的底层数据结构。
+ 逻辑层：描述数据库中存储什么数据以及这些数据间存在什么关系。
+ 视图层：最高层次的抽象，描述整个数据库的某个部分。多数用户不需要关心所有的信息，而只需要访问数据库的一部分，系统可以为同一数据库提供多个视图，同时屏蔽逻辑层细节和提供一些安全性机制。

### 实例和模式

&emsp;&emsp;**实例**：特定时刻存储在数据库中的信息的集合称作数据库的一个实例（instance）。  
&emsp;&emsp;**模式**：数据库的总体设计称作数据库模式（schema）。  

&emsp;&emsp;根据不同的数据抽象层次，数据库系统的三种不同模式：
+ 物理模式：在物理层描述数据库的设计。
+ 逻辑模式：在逻辑层描述数据库的设计。
+ 视图模式：也叫子模式，描述了数据库的不同视图。

### 数据模型

&emsp;&emsp;**数据模型**：数据库结构的基础是数据模型（data model）。数据模型是一个描述数据、数据联系、数据语义以及一致性约束的概念工具的集合。**数据模型提供了一种描述物理层、逻辑层以及视图层数据库设计的方式**。

&emsp;&emsp;四类数据模型：
+ 关系模型（relational model），最广泛使用的将数据存储到数据库中的模型。
+ 实体-联系模型（entity-relationship model，ER），用于数据库设计。
+ 面向对象的数据模型（object-based data model）。
+ 对象-关系数据模型（object-relational data model)，一个将对象数据模型和关系数据模型的特点结合在一起的数据模型。
+ 半结构化数据模型（semistructured data model），允许那些相同类型的数据项有不同的属性集的数据模型。

&emsp;&emsp;网状数据模型（network data model）和层次数据模型（hierarchical data model）先于关系模型出现，它们和底层的实现联系紧密，使数据建模变得复杂。

## 3. 数据库语言

&emsp;&emsp;数据库系统提供 **数据定义语言（data-definition language，DDL）** 来定义数据库模式，以及 **数据库操纵语言（data-manipulation language，DML）** 来表达数据库的查询与更新。

### DML：用户访问或操纵数据的语言，即增删改查

&emsp;&emsp;两类基本的数据操纵语言：
+ 过程化DML（procedural DML)，要求用户指定需要什么数据以及如何获得这些数据。
+ 声明式DML（declarative DML），非过程化DML，仅要求用户指定需要什么数据。

&emsp;&emsp;三个抽象层次不仅可以用于定义或构造数据，还可以用于操纵数据。在物理层，必须定义可高效访问数据的算法；在更高的抽象层次，则强调易用性。例如，数据库系统的查询处理器将DML的查询语句翻译成数据库系统物理层的动作序列。

### DDL：说明/定义数据库模式和数据的其他特征的语言，包括：

+ 数据库系统使用的存储结构和访问方式，即数据库模式的实现细节。
+ 一致性/完整性约束：
     - 域约束（domain constraint）。每个属性都必须对应于一个所有可能的取值构成的域（例如，整型、字符型、日期/时间型），约束它可以取的值。
     - 参照完整性（referential integrity）：一个关系中给定属性集上的取值也在另一关系的某一属性集的取值中出现。
     - 断言（assertion）。一个断言就是数据库需要时刻满足的某一条件，域约束和参照完整性是断言的特殊形式。
     - 授权（authorization）。对用户加以区别，以授权来表达：读权限、插入权限、更新权限、删除权限。

&emsp;&emsp;DDL 以一些指令（语句）作为输入，生成一些输出。DDL 的输出放在**数据字典（data dictionary）**中，数据字典包含了**元数据（metadata）**，元数据是关于数据的数据。可把数据字典看作一种特殊的表，只能由数据库系统本身来访问和修改，在读取和修改实际的数据前，数据库系统先要参考数据字典。

## 4. 关系数据库

&emsp;&emsp;关系数据库基于关系模型，使用一系列表来表达数据以及这些数据之间的联系。关系模型是基于记录的模型，数据库的结构是几种固定格式的记录。每个表包含一种特定类型的记录，每种记录类型定义固定数目的字段或属性，表的列对应记录类型的属性。

## 5. 数据库设计

&emsp;&emsp;数据库设计的主要内容是数据库模式的设计，实体-联系（E-R）数据模型是广泛用于数据库设计的数据模型，它提供了一种方便的图形化方式来观察数据、联系和约束。

### 设计过程

+ 高层的数据模型说明数据库用户的数据需求，以及怎样构造数据库结构满足这些需求。因此，数据库设计的初始阶段是全面刻画预期的数据库用户的数据需求，制定出用户需求的规格文档。
+ 选定数据模型，将需求转换成一个数据库的概念模式，它描述数据以及数据之间的联系，而不是指定物理的存储细节。关系模型中，概念设计包括数据库中的属性，以及如何将这些属性组织到多个表中，有商业上的决策（前者），也有计算机科学的问题（后者）。后者的两种解决方法：实体-联系模型以及规范化算法。
+ 在功能需求说明中，用户描述数据之上的各种操作（或事务），例如增删改查等。
+ 将抽象数据模型转换到数据库实现。
    - 逻辑设计阶段：设计者将高层的概念模式映射到要使用的数据库系统的实现数据模型上。
    - 物理设计阶段：指定数据库的物理特性，包括文件组织的形式以及内部的存储结构。

### 实体-联系模型

&emsp;&emsp;E-R 模型使用一组称为实体的基本对象，以及这些对象间的联系。数据库中实体通过属性集合来描述，联系是几个实体之间的关联。数据库的总体逻辑结构（模式）可以用实体-联系图（E-R 图）进行图形化表示。

### 规范化

&emsp;&emsp;规范化的目标是生成一个关系模式集合，使存储信息时没有不必要的冗余，同时又能很轻易地检索数据。这种方法是设计一种符合适当的范式（normal form）的模式。

## 6. 数据存储和查询

&emsp;&emsp;数据库系统划分为不同的模块，每个模块完成整个系统的一个功能。数据库系统的功能部件大致可分为存储管理器和查询处理器。

### 存储管理器（storage manager）

&emsp;&emsp;存储管理器负责在数据库中存储底层数据，也是应用程序以及向系统提交的查询之间提供接口的部件。存储管理器负责与文件管理器进行交互，原始数据通过操作系统提供的文件系统存储在磁盘上。存储管理器将各种DML语句翻译为底层文件系统命令。因此，存储管理器负责数据库中数据的存储、检索和更新。  
&emsp;&emsp;存储管理部件包括：
+ 权限及完整性管理器（authorization and integrity manager），检查完整性约束和用户权限。
+ 事务管理器（transaction manager）。
+ 文件管理器（file manager），管理磁盘空间的分配，管理用于表示磁盘上所存储信息的数据结构。
+ 缓冲区管理器（buffer manager），管理内存中的磁盘缓存。
+ 数据文件（data file），存储数据库自身。
+ 数据字典（data dictionary），存储关于数据库结构的元数据，尤其是数据库模式。
+ 索引（index），提供对数据项的快速访问。

### 查询处理器（query processor），编译和执行DDL和DML语句。
+ DDL解释器（DDL interpreter），解释DDL语句并将这些定义记录在数据字典中。
+ DML编译器（DML compiler），将DML语句翻译成一个执行方案，包括一系列查询执行引擎能理解的低级指令。DML编译器还进行查询优化。
+ 查询执行引擎（query evaluation engine），执行由DML编译器产生的低级指令。

## 7. 事务管理
+ 原子性（atomicity）：一种要么完成要么不发生的要求。
+ 一致性（consistency）：满足数据库一致性/完整性约束的正确性要求。
+ 持久性（durability）：数据能保持新值的要求。

&emsp;&emsp;事务（transaction）是数据库应用中完成单一逻辑功能的操作集合。每一个事务是一个既具有原子性又具一致性的单元。事务的定义应使之能保持数据库的一致性，这是程序员的职责。原子性和持久性的保证是 **恢复管理器（recovery manager）** 的职责，失败的事务使得数据库系统必须进行故障恢复，即检测系统故障并将数据库恢复到故障发生以前的状态。  
&emsp;&emsp;**并发控制管理器（concurrency control manager）** 控制并发事务间的相互影响，保证数据库一致性。  
&emsp;&emsp;**事务管理器（transaction manager）** 包括并发控制管理器和恢复管理器。

## 8. 数据库体系结构

&emsp;&emsp;数据库系统体系结构受支持其运行的计算机系统的影响很大。数据库系统可以是集中式的/客户-服务器方式的，还可以设计成能充分利用并行计算机系统结构的能力，也能设计成分布式的。

### 一个数据库系统各个部分以及它们之间联系的图：

![]()

# 二. 关系数据库

## 1. 关系模型

### 关系数据库的结构

&emsp;&emsp;关系数据库由表（table）的集合构成，每个表有唯一的名字。表中一行代表了一组值之间的一种联系，一个表就是这种联系的一个集合，表这个概念和数学上的**关系**这个概念是密切相关的，这也正是关系数据模型名称的由来。在数学上，n 个值之间的一种联系可以用关于这些值的一个 n 元组（n-tuple）来表示，对应于表中的一行。在关系模型的术语中，关系（relation）用来指代表，元组用来指代行，属性（attribute）指代表中的列。  
&emsp;&emsp;关系实例（relation instance）表示一个关系的特定实例，也就是表中所包含的一组特定的行。  
&emsp;&emsp;对于关系的每个属性，都存在一个允许取值的集合，称为该属性的域（domain）。对所有关系 r 而言，r 的所有属性的域都是原子的，即在数据库中使用域中元素时，域中元素被看作不可再分的单元。  
&emsp;&emsp;空（null）值是一个特殊的值，表示值未知或不存在。空值给数据库的访问和更新带来了很多困难，应尽量避免使用空值。

### 数据库模式

&emsp;&emsp;数据库模式是数据库的逻辑设计，数据库实例是给定时刻数据库中数据的一个快照。关系模式的概念相当于程序设计语言中类型定义的概念。一般来说，关系模式由属性序列及各属性对应域组成。关系实例的概念对应于程序设计语言中变量的值的概念。而关系的概念对应的则是变量的概念。关系的模式包括它的属性、属性类型以及关系上的约束。关系的模式是不常变化的。  
&emsp;&emsp;关系 department 的模式是：department（dept_name, building, budget）。属性可以重复，在关系模式中使用相同属性是将不同关系的元组联系起来的一种方法。

### 码

&emsp;&emsp;一个关系中没有两个元组在所有属性上的取值都相同。超码（superkey）是一个或多个属性的集合，这些属性的组合可以在一个关系中唯一地标识一个元组。如果 K 是超码，那么 K 的任意超集也是超码。最小的超码，即任意真子集都不是超码的超码，被称为候选码（candidate key）。主码（primary key）表示被数据库设计者选中的、主要用来在一个关系中区分不同元组的候选码。码是整个关系的一种性质，而非某个元组的性质。码的指定代表了被建模的事物在现实世界中的约束。  
&emsp;&emsp;一个关系模式（如r1）可能在它的属性中包含另一个关系模式（如r2）的主码。这个属性在 r1 上称作参照 r2 的外码（foreign key）。关系 r1 也称为外码依赖的参照关系（referencing relation），r2 叫做外码的被参照关系（referenced relation）。  
&emsp;&emsp;参照完整性（referential integrity constraint）：在 referencing relation 中任意元组在特定属性上的取值必然等于 referenced relation 中某个元组在特定属性上的取值。

### 关系运算

&emsp;&emsp;关系运算要么施加于单个关系上，要么施加于一对关系上，运算结果总是单个的关系。  
&emsp;&emsp;几种常用的关系运算：
+ 从单个关系中选出满足一些特定谓词的特殊元组，其结果是一个新关系，它是原始关系的一个子集。
+ 从一个关系中选出特定的属性（列），其结果是一个只包含被选择属性的新关系。
+ 连接运算，把分别来自两个关系的元组对合并成单个元组。
    - 自然连接运算：匹配两个关系在共有的所有属性上的取值相同的元组。
    - 笛卡儿积运算：匹配两个关系的所有元组，其结果包含来自两个关系元组的所有对，无论它们的属性值是否匹配。
+ 集合运算。关系是集合，可以在关系上施加标准的集合运算：交、并、差。

## 2. SQL的基本结构和概念

### SQL查询语言概览

&emsp;&emsp;结构化查询语言（SQL） 是最为广泛使用的关系数据库查询语言。  
&emsp;&emsp;SQL 语言的几个部分：
+ 数据定义语言（Data-Definition Language, DDL）：SQL DDL 提供定义关系模式、删除关系以及修改关系模式的命令。
+ 数据操纵语言（DML）： SQL DML 提供查询信息、插入元组、删除元组、修改元组的能力。
+ 完整性（integrity）：SQL DDL 包括定义完整性约束的命令。
+ 视图定义（view definition）：SQL DDL 包括定义视图的命令。
+ 事务控制（transaction control）：SQL 包括定义事物的开始和结束的命令。
+ 嵌入式 SQL 和动态 SQL（embedded SQL and dynamic SQL）：定义SQL语句如何嵌入到通用编程语言。
+ 授权（authorization）：SQL DDL 包括定义对关系和视图的访问权限的命令。

### SQL 的基本 DML 和 DDL 特征概述

#### SQL 数据定义

&emsp;&emsp;数据库中的关系集合必须由 DDL 指定给系统，SQL 的 DDL 能够定义关系以及每个关系的信息，包括：
+ 每个关系的模式。
+ 每个属性的取值类型。
+ 完整性约束。
+ 每个关系维护的索引集合。
+ 每个关系的安全性和权限信息。
+ 每个关系在磁盘上的物理存储结构。

&emsp;&emsp;SQL 支持的基本固有类型：
+ `char(n)`：固定长度的字符串，用户指定长度 n，全称 character。固定长度的字符串会追加空格使其达到固定的串长度。
+ `varchar(n)`：可变长度的字符串，用户指定最大长度 n，全称 character varying。
+ `int`：整数类型，全称 integer。
+ `smallint`：小整数类型。
+ `numeric(p, d)`：定点数，精度由用户指定。这个数有 p 位数（加上一个符号位），其中 d 位数字在小数点右边。
+ `real, double precision`：浮点数与双精度浮点数，精度与机器相关。
+ `float(n)`：精度至少为 n 位的浮点数。

&emsp;&emsp; SQL 也提供 `nvarchar` 类型存放 Unicode 数据，很多数据库允许在 varchar 类型中存放 Unicode（采用 UTF-8）。

&emsp;&emsp;SQL 的基本模式定义：create table 命令定义 SQL 关系。create table 命令的通用形式是：
```sql
    create table r ( A1  D1, 
                     A2  D2, 
                     ..., 
                     An  Dn, 
                     <完整性约束1>,
                     ...,
                     <完整性约束k> );
```
&emsp;&emsp;其中 r 是关系名，Ai 是关系 r 模式中的一个属性名，Di 是属性 Ai 的域。SQL 支持的几个完整性约束：
+ `primary key (Aj1, Aj2, ..., Ajm)` ：primary-key 声明表示属性 Aj1、Aj2、...、Ajm 构成关系的主码。主码属性必须非空且唯一。
+ `foreign key (Ak1, Ak2, ..., Akn) references s` ：foreign key声明表示关系中任意元组在属性（Ak1,Ak2,...,Akn）上的取值必须对应于关系 s 中某元组在主码属性上的取值。
+ `not null`：一个属性上的 not null 约束表明在该属性上不允许空值。

&emsp;&emsp;大学数据库的部分SQL数据定义：

![]()

&emsp;&emsp;SQL禁止破坏完整性约束的任何数据库更新。  
&emsp;&emsp;命令 `drop table r;` 从数据库中删除关系 r。`alter table r add A D;` 为已有的关系 r 增加域为 D 的属性 A，关系 r 中所有元组在新属性 A 上的取值将被设为 null。命令 `alter table r drop A;` 从关系 r 中去掉属性 A。

&emsp;&emsp;在关系模型的形式化数学定义中，关系是一个集合。然而在实践中，去除重复是相当费时的，所以SQL允许在关系以及SQL表达式结果中出现重复。  
&emsp;&emsp;SQL查询的基本结构由三个子句构成：select、from 和 where。查询的输入是在 from 子句中列出的关系，where 和 select 子句指定运算，查询的结果元组构成一个关系。可在 select 子句后加入关键字 distinct 强行删除重复，使用关键字 all 显式指明不删除重复，不过保留重复元组是默认的。select 子句可带含有数学运算符的算术表达式，运算对象可以是常数或元组的属性。where 子句在 from 子句的结果关系中选出满足特定谓词的元组，可以在 where 子句中使用逻辑连词 and、or、not，也可包含比较运算符来比较字符串、算术表达式以及特殊类型，比如日期。  
&emsp;&emsp;select 子句列出查询结果中所需要的属性；from 子句列出查询求值中所需要访问的关系列表，where 子句则列出作用在 from 子句中关系的属性上的谓词。理解查询所代表运算最容易的方式是以运算的顺序来考察各子句：首先是 from，然后是 where，最后是 select。from 子句定义了一个在该子句中所列出关系上的笛卡儿积。where 子句中的谓词用来限制笛卡儿积所建立的组合，只留下那些对所需答案有意义的组合。  
&emsp;&emsp;一个SQL查询的含义理解：
+ 为from子句中列出的关系产生笛卡儿积。
+ 在上一步的结果上应用 where 子句中指定的谓词。
+ 对于上一步结果中的每个元组，输出 select 子句中指定的属性（或表达式的结果）。
&emsp;&emsp;SQL的实际实现中会尽可能地只产生满足 where 子句谓词的笛卡儿积元素来进行优化执行。